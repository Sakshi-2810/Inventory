<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"/>
    <title>Generate Invoice</title>
    <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
    <link rel="icon"
          href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üßæ</text></svg>"/>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet"/>
    <style>
        :root {
          --primary: #2563eb;
          --primary-dark: #1e40af;
          --secondary: #6b7280;
          --bg: #f9fafb;
          --card-bg: #fff;
          --input-bg: #f3f4f6;
          --border-color: #d1d5db;
          --radius: 6px;
          --shadow: 0 2px 10px rgba(38,50,56,0.08);
          --font-main: 'Inter', Arial, sans-serif;
        }

        * { box-sizing: border-box; }

        body {
          font-family: var(--font-main);
          background: var(--bg);
          margin: 0;
          padding: 20px;
        }

        h2 {
          margin-bottom: 16px;
          font-weight: 700;
          font-size: 1.8rem;
          color: var(--primary-dark);
        }

        label {
          display: block;
          margin-bottom: 4px;
          font-weight: 600;
          font-size: 0.9rem;
          color: #374151;
        }

        .form-row { display: flex; flex-wrap: wrap; gap: 12px; margin-bottom: 16px; }
        .form-group { flex: 1 1 0; min-width: 180px; display: flex; flex-direction: column; }

        input, select {
          width: 100%;
          padding: 8px 10px;
          border-radius: var(--radius);
          border: 1.5px solid var(--border-color);
          font-size: 0.95rem;
          background: var(--input-bg);
          transition: border-color 0.2s ease;
        }

        input:focus, select:focus {
          outline: none;
          border-color: var(--primary);
          background: #fff;
          box-shadow: 0 0 4px rgba(37, 99, 235, 0.2);
        }

        input[readonly] { background: #e5e7eb; color: #6b7280; }

        table {
          width: 100%;
          border-collapse: separate;
          border-spacing: 0;
          border-radius: var(--radius);
          overflow: hidden;
          margin-bottom: 12px;
          background: var(--card-bg);
          box-shadow: var(--shadow);
        }

        th, td {
          padding: 10px 12px;
          font-size: 0.95rem;
          text-align: left;
        }

        th { background: #e0e7ff; font-weight: 600; border-bottom: 1.5px solid var(--primary); }
        td { border-bottom: 1px solid #e5e7eb; }
        tr:last-child td { border-bottom: none; }

        button {
          font-family: var(--font-main);
          cursor: pointer;
          border-radius: var(--radius);
          border: none;
          padding: 8px 16px;
          font-weight: 600;
          font-size: 0.95rem;
          transition: background 0.2s ease, box-shadow 0.2s ease;
        }

        button:focus { outline: 2px solid var(--primary); outline-offset: 2px; }

        .btn.primary { background-color: var(--primary); color: #fff; }
        .btn.primary:hover { background-color: var(--primary-dark); }

        .btn.secondary { background-color: var(--secondary); color: #fff; }
        .btn.secondary:hover { background-color: #4b5563; }

        #addRowBtn {
          background: var(--primary);
          color: #fff;
          font-size: 1rem;
          display: inline-flex;
          align-items: center;
          gap: 6px;
        }

        #btnHome {
          position: fixed;
          top: 12px;
          right: 12px;
          background: var(--card-bg);
          color: var(--primary);
          border: 1.5px solid var(--primary);
          padding: 8px 12px;
          border-radius: 10px;
          display: flex;
          flex-direction: column;
          align-items: center;
          justify-content: center;
          z-index: 9999;
        }

        #btnHome:hover { background: var(--primary); color: #fff; }

        #btnHome svg { width: 22px; height: 22px; }
        #btnHome small { font-size: 10px; margin-top: 2px; }

        @media (max-width: 600px) {
          .form-row { flex-direction: column; }
          table, th, td { font-size: 0.85rem; }
        }
         .spinner {
  width: 48px; height: 48px;
  border: 6px solid #e2e8f7;
  border-top: 6px solid #1967d2;
  border-radius: 50%;
  animation: spin 0.77s linear infinite;
}
@keyframes spin { to { transform: rotate(360deg); } }
#loaderOverlay { opacity: 1; pointer-events: all; }
#loaderOverlay.hide { opacity: 0; pointer-events: none; }
.btn {
    position: relative;
    display: inline-flex;
    align-items: center;
    justify-content: center;
}

.spinner {
    border: 2px solid #f3f3f3; /* Light grey */
    border-top: 2px solid #3498db; /* Blue */
    border-radius: 50%;
    width: 16px;
    height: 16px;
    animation: spin 1s linear infinite;
    margin-left: 8px; /* space between text and spinner */
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}
/* Notification banner styles */
.notification {
  position: fixed;
  top: 20px;
  left: 50%;
  transform: translateX(-50%);
  min-width: 300px;
  max-width: 600px;
  padding: 15px 20px;
  border-radius: 5px;
  color: #fff;
  font-weight: bold;
  font-family: Arial, sans-serif;
  box-shadow: 0 2px 8px rgba(0,0,0,0.2);
  z-index: 9999;
  display: flex;
  justify-content: space-between;
  align-items: center;
  animation: slideDown 0.5s ease;
}

.notification.success {
  background-color: #28a745; /* green */
}

.notification.error {
  background-color: #dc3545; /* red */
}

.notification .close-btn {
  background: none;
  border: none;
  color: #fff;
  font-size: 18px;
  cursor: pointer;
}

/* Slide-down animation */
@keyframes slideDown {
  from { transform: translate(-50%, -50px); opacity: 0; }
  to { transform: translate(-50%, 0); opacity: 1; }
}
 #stockTable {
    width: 100%;
    table-layout: auto; /* allows auto width based on content */
  }

  #stockTable th, #stockTable td {
    /* border: 1px solid #ccc; */
    padding: 8px;
    text-align: left;
    /*white-space: nowrap;  prevents wrapping */
  }

  /* Optional: give other columns fixed width if needed */
  /* #stockTable th:nth-child(2), */
  #stockTable td:nth-child(2) {
    width: 30%;
  }
  .header-row > :last-child {
  margin-left: auto;
  margin-right: auto;
}
 .header-row { display: flex; align-items: center; gap: 18px; margin-bottom: 16px;   justify-content: flex-start;}
  .btn-home {
    background: #e3e9ef;
    color: #1967d2;
    font-weight: 600;
    border: none;
    margin-right: 10px;
    padding: 8px 16px;
    border-radius: 6px;
    box-shadow: 0 1px 6px rgba(25,103,210,0.05);
    transition: background 0.18s, color 0.18s;
}
.btn-home:hover {
    background: #cad6f3;
    color: #174ea6;
}
    </style>
</head>
<body>
  <!-- Banner container (fixed at top) -->
<div id="notification" class="notification" style="display:none;">
  <span id="notification-message"></span>
  <button onclick="closeNotification()" class="close-btn">&times;</button>
</div>

<div id="loaderOverlay" style="
  position: fixed;
  top:0; left:0; width:100vw; height:100vh; background:rgba(255,255,255,0.85);
  z-index: 9999; display: flex; align-items: center; justify-content: center;
  transition: opacity 0.22s;">
    <div style="display: flex; flex-direction: column; align-items: center;">
      <div class="spinner"></div>
      <div style="margin-top:16px; color:#1967d2; font-weight: 600; font-size:1.07em;">Loading...</div>
    </div>
  </div>

<div class="header-row">
    <button class="btn btn-home" onclick="goHome()">üè† Home</button>
    <h2>New Invoice</h2>
</div>

<form id="invoiceForm" novalidate>
    <div class="form-row">
        <div class="form-group">
            <label for="partyInput">Bill To</label>
            <input list="partyOptions" id="partyInput" name="partyName" placeholder="Search or type new party" required
                   autocomplete="off">
            <datalist id="partyOptions"></datalist>
        </div>
        <div class="form-group">
            <label for="transactionType">Transaction Type</label>
            <select name="transactionType" id="transactionType" required>
                <option value="SELL">SELL</option>
                <option value="BUY">BUY</option>
            </select>
        </div>
    </div>

    <h3>Stock Details</h3>
    <button type="button" class="btn primary" id="openImportModalBtn">Import from Excel</button>

    <!-- Import Modal -->
    <div id="importModal" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.18); z-index:10000; align-items:center; justify-content:center;">
      <div style="background:#fff; border-radius:10px; padding:28px 24px; min-width:320px; max-width:95vw; box-shadow:0 4px 32px rgba(25,103,210,0.13); position:relative;">
        <button onclick="closeImportModal()" style="position:absolute; top:10px; right:12px; background:none; border:none; font-size:22px; color:#888; cursor:pointer;">&times;</button>
        <h3 style="margin-top:0;">Import Stock Data from Excel</h3>
        <ol style="font-size:1em; color:#333; margin-bottom:12px;">
          <li>Download the <a href="#" id="downloadTemplateLink">Excel template</a>.</li>
          <li>Fill in your stock details in the template.</li>
          <li>Click "Choose File" to select your Excel file and import.</li>
        </ol>
        <div style="margin-bottom:10px; color:#555;">
          <b>Required columns:</b> <br>
          <code>Stock Name | Qty | Unit | Price | GST</code>
        </div>
        <input type="file" id="excelFileInput" accept=".xlsx,.xls" style="margin-bottom:14px;">
        <div>
          <button type="button" class="btn primary" id="importExcelConfirmBtn">Import</button>
          <button type="button" class="btn secondary" onclick="closeImportModal()">Cancel</button>
        </div>
      </div>
    </div>
    
    <table id="stockTable">
        <thead>
        <tr>
            <th>S.No.</th>
            <th>Stock Name</th>
            <th>Qty</th>
            <th>Unit</th>
            <th>Price</th>
            <th>GST (%)</th>
            <th>Total</th>
            <th>Action</th>
        </tr>
        </thead>
        <tbody></tbody>
    </table>
    <button type="button" id="addRowBtn">‚ûï Add Stock</button>

    <datalist id="stockOptions"></datalist>

    <div class="form-row" style="margin-top:16px;">
        <div class="form-group">
            <label for="totalCost">Total Cost</label>
            <input id="totalCost" type="text" readonly value="Click Calculate">
        </div>
        <div class="form-group">
            <label for="gst">Total GST</label>
            <input id="gst" type="text" readonly value="Click Calculate">
        </div>
       <div class="form-group">
          <label for="additionalDiscount">Additional Discount</label>
          <div style="display:flex; gap:8px; align-items:center;">
            <input 
              name="additionalDiscount" 
              id="additionalDiscount" 
              type="number" 
              min="0" 
              placeholder="Enter discount" 
            >
            <select id="discountType" >
              <option value="amount">‚Çπ Amount</option>
              <option value="percent">% Percent</option>
            </select>
          </div>
        </div>

        <div class="form-group">
            <label for="paidAmount">Amount Paid</label>
            <input name="paidAmount" id="paidAmount" type="number" min="0" placeholder="0">
        </div>
    </div>

    <div class="form-row" style="margin-top:12px; display:flex; gap:10px;">
        <button type="button" class="btn secondary" id="calculateBtn" onclick="calculateCost()">
            <span class="btn-text">Calculate Cost</span>
            <span class="spinner" style="display:none;"></span>
        </button>
        <button type="submit" class="btn primary" id="generateBtn">
            <span class="btn-text">Generate Invoice</span>
            <span class="spinner" style="display:none;"></span>
        </button>
    </div>

</form>

<script src="invoice.js"></script>

</body>
</html>
